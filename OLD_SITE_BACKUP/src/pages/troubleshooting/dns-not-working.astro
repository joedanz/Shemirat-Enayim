---
import Layout from '../../layouts/Layout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import Alert from '../../components/Alert.astro';
import Accordion from '../../components/Accordion.astro';
---

<Layout
	title="Troubleshooting: DNS Changes Not Taking Effect"
	description="Step-by-step guide to fix DNS filtering issues when changes aren't working. Learn how to flush DNS cache, verify settings, and resolve common problems."
>
	<Breadcrumb />

	<div class="guide-container">
		<header class="guide-header">
			<div class="difficulty-badge beginner">Beginner</div>
			<h1>DNS Changes Not Taking Effect</h1>
			<p class="subtitle">
				Your DNS filtering isn't working even after changing settings. This guide will help you diagnose and fix the issue.
			</p>
			<div class="meta">
				<span>‚è±Ô∏è Time Required: 10-15 minutes</span>
				<span>üîß Difficulty: Beginner</span>
			</div>
		</header>

		<Alert type="info">
			<strong>Quick Check:</strong> Before diving deep, try restarting your router and device. This resolves 30% of DNS issues immediately.
		</Alert>

		<section class="guide-section">
			<h2>Understanding the Problem</h2>
			<p>
				When DNS filtering "doesn't work," it usually means one of these situations:
			</p>
			<ul>
				<li>You changed DNS settings but can still access blocked sites</li>
				<li>Filtering works on some devices but not others</li>
				<li>Filtering worked initially but stopped</li>
				<li>Changes take forever to apply</li>
			</ul>
			<p>
				This happens because DNS information is cached at multiple levels: router, device, browser, and apps.
			</p>
		</section>

		<section class="guide-section">
			<h2>Step-by-Step Solution</h2>

			<div class="step">
				<h3><span class="step-number">1</span> Verify DNS Settings Are Correct</h3>
				<p>First, confirm your DNS servers are actually set correctly:</p>

				<h4>On Router:</h4>
				<ol>
					<li>Log into your router admin panel (usually 192.168.1.1 or 192.168.0.1)</li>
					<li>Navigate to Internet/WAN settings</li>
					<li>Look for "DNS Server" or "Primary/Secondary DNS"</li>
					<li>Verify the correct filtering DNS addresses are entered</li>
				</ol>

				<div class="info-box">
					<strong>Common Filtering DNS Servers:</strong>
					<ul>
						<li><strong>OpenDNS FamilyShield:</strong> 208.67.222.123 / 208.67.220.123</li>
						<li><strong>CleanBrowsing Family:</strong> 185.228.168.168 / 185.228.169.168</li>
						<li><strong>Cloudflare Family:</strong> 1.1.1.3 / 1.0.0.3</li>
					</ul>
				</div>

				<h4>On Windows Device:</h4>
				<ol>
					<li>Open Settings ‚Üí Network & Internet ‚Üí Advanced network settings</li>
					<li>Click your connection ‚Üí View additional properties</li>
					<li>Check "DNS server assignment"</li>
					<li>Should say "Automatic (DHCP)" if using router DNS</li>
				</ol>

				<h4>On Mac Device:</h4>
				<ol>
					<li>System Settings ‚Üí Network ‚Üí Your connection ‚Üí Details</li>
					<li>Click "DNS" tab</li>
					<li>Should be empty or show router IP if using router DNS</li>
				</ol>

				<h4>On iOS Device:</h4>
				<ol>
					<li>Settings ‚Üí Wi-Fi ‚Üí Tap (i) next to network name</li>
					<li>Scroll to "DNS"</li>
					<li>Should show "Automatic" or router IP if using router DNS</li>
				</ol>

				<Alert type="warning">
					<strong>Important:</strong> If DNS is set on both router AND device, the device setting wins.
					Remove device-level DNS settings to use router filtering.
				</Alert>
			</div>

			<div class="step">
				<h3><span class="step-number">2</span> Flush DNS Cache</h3>
				<p>Clear cached DNS entries that may be overriding your new settings:</p>

				<h4>Windows:</h4>
				<pre><code>ipconfig /flushdns</code></pre>
				<p>Open Command Prompt as Administrator, run the command, and restart your computer.</p>

				<h4>Mac:</h4>
				<pre><code>sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder</code></pre>
				<p>Open Terminal, run the command, enter your password, and restart your Mac.</p>

				<h4>iOS:</h4>
				<ol>
					<li>Settings ‚Üí General ‚Üí Transfer or Reset iPhone</li>
					<li>Reset ‚Üí Reset Network Settings</li>
					<li>Note: This will forget all Wi-Fi passwords</li>
				</ol>

				<h4>Android:</h4>
				<ol>
					<li>Settings ‚Üí Apps ‚Üí See all apps ‚Üí Show system</li>
					<li>Find "Private DNS Provider"</li>
					<li>Tap "Storage & cache" ‚Üí Clear cache</li>
					<li>Or restart device (easier method)</li>
				</ol>

				<h4>Router:</h4>
				<ol>
					<li>Power off router completely (unplug from power)</li>
					<li>Wait 30 seconds</li>
					<li>Power back on and wait 2-3 minutes for full restart</li>
				</ol>
			</div>

			<div class="step">
				<h3><span class="step-number">3</span> Check for DNS Overrides</h3>
				<p>Some apps and settings bypass your DNS configuration:</p>

				<h4>Disable DNS over HTTPS (DoH):</h4>

				<strong>Chrome:</strong>
				<ol>
					<li>Settings ‚Üí Privacy and security ‚Üí Security</li>
					<li>Scroll to "Use secure DNS"</li>
					<li>Toggle OFF or select "With your current service provider"</li>
				</ol>

				<strong>Firefox:</strong>
				<ol>
					<li>Settings ‚Üí Privacy & Security</li>
					<li>Scroll to "DNS over HTTPS"</li>
					<li>Select "Off"</li>
				</ol>

				<strong>Edge:</strong>
				<ol>
					<li>Settings ‚Üí Privacy, search, and services</li>
					<li>Scroll to "Security"</li>
					<li>Toggle OFF "Use secure DNS"</li>
				</ol>

				<h4>Check for VPN or Proxy Apps:</h4>
				<ul>
					<li>VPN apps bypass your DNS settings entirely</li>
					<li>Uninstall or disable any VPN apps</li>
					<li>On iOS: Settings ‚Üí General ‚Üí VPN & Device Management</li>
					<li>On Android: Settings ‚Üí Network ‚Üí VPN</li>
				</ul>

				<h4>Mobile Data:</h4>
				<Alert type="info">
					DNS filtering only works on Wi-Fi. Mobile data uses your carrier's DNS servers.
					Use device-level controls (Screen Time, Family Link) for cellular protection.
				</Alert>
			</div>

			<div class="step">
				<h3><span class="step-number">4</span> Test DNS Configuration</h3>
				<p>Verify your DNS filtering is actually active:</p>

				<h4>Method 1: Command Line Test</h4>

				<strong>Windows/Mac Terminal:</strong>
				<pre><code>nslookup example.com</code></pre>
				<p>
					Look at the "Address" line at the top. It should show your filtering DNS server
					(e.g., 208.67.222.123 for OpenDNS), NOT your ISP's DNS (e.g., not 8.8.8.8).
				</p>

				<h4>Method 2: Web-Based Test</h4>
				<ol>
					<li>Visit <strong>https://www.dnsleaktest.com/</strong></li>
					<li>Click "Extended test"</li>
					<li>Check if results show your filtering DNS provider</li>
					<li>Should show "OpenDNS" or "CleanBrowsing," not your ISP</li>
				</ol>

				<h4>Method 3: Block Test</h4>
				<ol>
					<li>Try visiting a site that should be blocked (e.g., adult content test page)</li>
					<li>OpenDNS users can test with: <code>internetbadguys.com</code></li>
					<li>Should see a block page, not the actual site</li>
				</ol>
			</div>

			<div class="step">
				<h3><span class="step-number">5</span> Advanced Troubleshooting</h3>
				<p>If basic steps didn't work, try these advanced solutions:</p>

				<h4>Set Static DNS on Router (Recommended):</h4>
				<ol>
					<li>Log into router admin</li>
					<li>Find "Internet" or "WAN" settings</li>
					<li>Change from "Automatic DNS" to "Manual/Static DNS"</li>
					<li>Enter filtering DNS servers</li>
					<li>Save and reboot router</li>
				</ol>

				<h4>Disable IPv6 (Temporary Test):</h4>
				<p>
					Some routers don't properly pass DNS settings to IPv6. Temporarily disable IPv6 to test:
				</p>
				<ol>
					<li>Router settings ‚Üí IPv6 ‚Üí Disable</li>
					<li>Save and reboot</li>
					<li>Test if filtering now works</li>
					<li>If yes, contact your filtering DNS provider about IPv6 support</li>
				</ol>

				<h4>Check Firmware Updates:</h4>
				<ol>
					<li>Router admin ‚Üí Firmware or System</li>
					<li>Check for updates</li>
					<li>Update if available (older firmware has bugs)</li>
				</ol>

				<h4>Factory Reset Router (Last Resort):</h4>
				<Alert type="warning">
					This erases all settings. Document your WiFi name, password, and settings first!
				</Alert>
				<ol>
					<li>Hold router's reset button for 30 seconds</li>
					<li>Router will restart with factory defaults</li>
					<li>Reconfigure everything from scratch</li>
					<li>Apply DNS settings again</li>
				</ol>
			</div>
		</section>

		<section class="guide-section">
			<h2>Common Scenarios & Solutions</h2>
			<div class="accordion-list">
				<Accordion title="Filtering works on some devices but not others">
					<p>This means affected devices have their own DNS settings overriding the router:</p>
					<ul>
						<li>Check device DNS settings (see Step 1)</li>
						<li>Remove any custom DNS configurations</li>
						<li>Turn off VPN apps on those devices</li>
						<li>Disable DoH in browsers (see Step 3)</li>
						<li>Restart the affected devices</li>
					</ul>
				</Accordion>

				<Accordion title="Filtering worked yesterday but stopped today">
					<p>Something changed. Common causes:</p>
					<ul>
						<li><strong>Router firmware auto-updated:</strong> Check DNS settings weren't reset</li>
						<li><strong>ISP modem reset:</strong> Power outage can reset modem, which resets router</li>
						<li><strong>Browser updated:</strong> New browser versions may enable DoH automatically</li>
						<li><strong>Someone changed settings:</strong> Check router admin login history if available</li>
					</ul>
				</Accordion>

				<Accordion title="Changes take 24+ hours to apply">
					<p>DNS propagation shouldn't take more than a few minutes. If it does:</p>
					<ul>
						<li>Your DNS cache isn't being flushed properly</li>
						<li>Restart router AND all devices (not just flush cache)</li>
						<li>Check if you have nested routers (modem/router combo + separate router)</li>
						<li>Some ISP modem/router combos cache DNS aggressively - put ISP box in bridge mode</li>
					</ul>
				</Accordion>

				<Accordion title="Test shows wrong DNS server">
					<p>If nslookup or leak tests show your ISP's DNS instead of filtering DNS:</p>
					<ul>
						<li>Router isn't actually applying DNS settings (firmware issue)</li>
						<li>ISP modem is overriding router DNS (put modem in bridge mode)</li>
						<li>Device has static DNS set locally (override router)</li>
						<li>Try setting DNS on each device individually as workaround</li>
					</ul>
				</Accordion>

				<Accordion title="Router doesn't have manual DNS option">
					<p>Some basic routers don't allow custom DNS. Solutions:</p>
					<ul>
						<li><strong>Best:</strong> Upgrade to a router that supports custom DNS ($50-100)</li>
						<li><strong>Alternative:</strong> Set DNS on each device individually</li>
						<li><strong>Advanced:</strong> Use DNS filtering that provides VPN profiles (NextDNS, CleanBrowsing)</li>
						<li>See our <a href="/guides/router-config">router configuration guide</a> for compatible models</li>
					</ul>
				</Accordion>
			</div>
		</section>

		<section class="guide-section">
			<h2>Prevention Tips</h2>
			<ul class="checklist">
				<li>Document your DNS settings (write them down or take screenshots)</li>
				<li>Check DNS configuration monthly to ensure it hasn't reverted</li>
				<li>Subscribe to your filtering provider's status updates for outages</li>
				<li>Set a calendar reminder to test filtering quarterly</li>
				<li>Use monitoring software (Qustodio, Bark) as a backup alert system</li>
				<li>Teach older kids not to change DNS settings without permission</li>
			</ul>
		</section>

		<section class="guide-section">
			<h2>Still Not Working?</h2>
			<p>If you've tried everything and DNS filtering still isn't working:</p>
			<ol>
				<li><strong>Contact your filtering provider's support</strong> - they can check if their servers are blocking your requests</li>
				<li><strong>Try a different filtering DNS provider</strong> - some routers have compatibility issues</li>
				<li><strong>Switch to software-based filtering</strong> - install Qustodio or Net Nanny as an alternative</li>
				<li><strong>Consult our <a href="/faq">FAQ section</a></strong> for more troubleshooting tips</li>
				<li><strong>Reach out via our <a href="/contact">contact form</a></strong> with your router model and symptoms</li>
			</ol>
		</section>

		<div class="related-guides">
			<h2>Related Guides</h2>
			<div class="related-grid">
				<a href="/guides/dns-filtering" class="related-card">
					<h3>DNS Filtering Setup</h3>
					<p>Complete guide to configuring DNS filtering from scratch</p>
				</a>
				<a href="/troubleshooting/slow-internet" class="related-card">
					<h3>Slow Internet After Filtering</h3>
					<p>Fix performance issues caused by filtering</p>
				</a>
				<a href="/guides/router-config" class="related-card">
					<h3>Router Configuration</h3>
					<p>Router-specific setup instructions</p>
				</a>
			</div>
		</div>
	</div>
</Layout>

<style>
	.guide-container {
		max-width: 900px;
		margin: 0 auto;
		padding: var(--space-8) var(--space-4);
	}

	.guide-header {
		position: relative;
		padding-bottom: var(--space-6);
		border-bottom: 3px solid var(--color-primary-500);
		margin-bottom: var(--space-8);
	}

	.difficulty-badge {
		display: inline-block;
		padding: var(--space-2) var(--space-4);
		border-radius: var(--radius-full);
		font-size: var(--text-sm);
		font-weight: 600;
		margin-bottom: var(--space-4);
	}

	.difficulty-badge.beginner {
		background-color: var(--color-secondary-100);
		color: var(--color-secondary-800);
	}

	.guide-header h1 {
		font-size: var(--text-4xl);
		font-weight: 800;
		color: var(--color-gray-900);
		margin-bottom: var(--space-3);
		line-height: var(--leading-tight);
	}

	.subtitle {
		font-size: var(--text-xl);
		color: var(--color-gray-600);
		line-height: var(--leading-relaxed);
		margin-bottom: var(--space-4);
	}

	.meta {
		display: flex;
		gap: var(--space-6);
		flex-wrap: wrap;
		font-size: var(--text-base);
		color: var(--color-gray-600);
	}

	.guide-section {
		margin-top: var(--space-10);
	}

	.guide-section h2 {
		font-size: var(--text-3xl);
		font-weight: 700;
		color: var(--color-gray-900);
		margin-bottom: var(--space-6);
		padding-top: var(--space-4);
	}

	.guide-section h3 {
		font-size: var(--text-2xl);
		font-weight: 600;
		color: var(--color-gray-900);
		margin-top: var(--space-8);
		margin-bottom: var(--space-4);
	}

	.guide-section h4 {
		font-size: var(--text-lg);
		font-weight: 600;
		color: var(--color-gray-800);
		margin-top: var(--space-6);
		margin-bottom: var(--space-3);
	}

	.guide-section p,
	.guide-section li {
		line-height: var(--leading-relaxed);
		color: var(--color-gray-700);
		margin-bottom: var(--space-3);
	}

	.guide-section ul,
	.guide-section ol {
		margin-left: var(--space-6);
		margin-bottom: var(--space-4);
	}

	.guide-section li {
		margin-bottom: var(--space-2);
	}

	.guide-section a {
		color: var(--color-primary-600);
		text-decoration: underline;
		transition: color var(--transition-base);
	}

	.guide-section a:hover {
		color: var(--color-primary-700);
	}

	.step {
		background-color: var(--color-white);
		border: 2px solid var(--color-gray-200);
		border-radius: var(--radius-lg);
		padding: var(--space-6);
		margin-bottom: var(--space-6);
	}

	.step h3 {
		display: flex;
		align-items: center;
		gap: var(--space-3);
		margin-top: 0;
	}

	.step-number {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 40px;
		height: 40px;
		background-color: var(--color-primary-600);
		color: var(--color-white);
		border-radius: 50%;
		font-weight: 700;
		font-size: var(--text-xl);
	}

	.info-box {
		background-color: var(--color-primary-50);
		border-left: 4px solid var(--color-primary-500);
		padding: var(--space-4);
		margin: var(--space-4) 0;
		border-radius: var(--radius-base);
	}

	.info-box strong {
		display: block;
		color: var(--color-primary-900);
		margin-bottom: var(--space-2);
	}

	.info-box ul {
		margin-left: var(--space-4);
		margin-bottom: 0;
	}

	pre {
		background-color: var(--color-gray-900);
		color: var(--color-secondary-300);
		padding: var(--space-4);
		border-radius: var(--radius-base);
		overflow-x: auto;
		margin: var(--space-4) 0;
	}

	code {
		font-family: 'Courier New', monospace;
		font-size: var(--text-sm);
	}

	.accordion-list {
		display: flex;
		flex-direction: column;
		gap: var(--space-4);
		margin-top: var(--space-6);
	}

	.checklist {
		list-style: none;
		margin-left: 0;
	}

	.checklist li {
		padding-left: var(--space-6);
		position: relative;
	}

	.checklist li:before {
		content: '‚úì';
		position: absolute;
		left: 0;
		color: var(--color-secondary-600);
		font-weight: 700;
	}

	.related-guides {
		margin-top: var(--space-12);
		padding-top: var(--space-8);
		border-top: 2px solid var(--color-gray-200);
	}

	.related-guides h2 {
		font-size: var(--text-2xl);
		font-weight: 700;
		color: var(--color-gray-900);
		margin-bottom: var(--space-6);
	}

	.related-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
		gap: var(--space-4);
	}

	.related-card {
		display: block;
		padding: var(--space-5);
		background-color: var(--color-gray-50);
		border: 1px solid var(--color-gray-200);
		border-radius: var(--radius-lg);
		text-decoration: none;
		transition: all var(--transition-base);
	}

	.related-card:hover {
		border-color: var(--color-primary-500);
		background-color: var(--color-white);
		transform: translateY(-2px);
		box-shadow: var(--shadow-lg);
	}

	.related-card h3 {
		font-size: var(--text-lg);
		font-weight: 600;
		color: var(--color-gray-900);
		margin: 0 0 var(--space-2) 0;
	}

	.related-card p {
		font-size: var(--text-sm);
		color: var(--color-gray-600);
		margin: 0;
		line-height: var(--leading-snug);
	}

	@media (max-width: 768px) {
		.guide-header h1 {
			font-size: var(--text-3xl);
		}

		.subtitle {
			font-size: var(--text-lg);
		}

		.meta {
			flex-direction: column;
			gap: var(--space-2);
		}

		.related-grid {
			grid-template-columns: 1fr;
		}
	}
</style>
