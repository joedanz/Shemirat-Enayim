---
import Layout from '../../layouts/Layout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import Alert from '../../components/Alert.astro';
import Accordion from '../../components/Accordion.astro';
---

<Layout
	title="Troubleshooting: Internet Slowdown After Filtering"
	description="Fix internet speed issues caused by content filtering. Learn how to identify bottlenecks and optimize DNS filtering performance."
>
	<Breadcrumb />

	<div class="guide-container">
		<header class="guide-header">
			<div class="difficulty-badge intermediate">Intermediate</div>
			<h1>Internet Slowdown After Filtering</h1>
			<p class="subtitle">
				Your connection feels sluggish after implementing filtering. Let's identify and fix performance bottlenecks.
			</p>
			<div class="meta">
				<span>‚è±Ô∏è Time Required: 15-30 minutes</span>
				<span>üîß Difficulty: Intermediate</span>
			</div>
		</header>

		<Alert type="info">
			<strong>Reality Check:</strong> Properly configured DNS filtering adds only 1-5ms latency (imperceptible).
			If you're experiencing significant slowdowns, something else is wrong.
		</Alert>

		<section class="guide-section">
			<h2>First: Baseline Your Speed</h2>
			<p>Before troubleshooting, measure your actual speeds:</p>

			<div class="step">
				<h3><span class="step-number">1</span> Run Speed Tests</h3>
				<ol>
					<li>Temporarily disable filtering (change DNS back to automatic)</li>
					<li>Visit <strong>fast.com</strong> or <strong>speedtest.net</strong></li>
					<li>Record: Download, Upload, Ping/Latency</li>
					<li>Re-enable filtering (restore DNS settings)</li>
					<li>Run the same test again</li>
					<li>Compare results</li>
				</ol>

				<div class="info-box">
					<strong>What's Normal:</strong>
					<ul>
						<li><strong>Ping increase:</strong> 1-5ms is normal, 10-20ms is acceptable</li>
						<li><strong>Download/Upload:</strong> Should see no change (0-2% variation)</li>
						<li><strong>Red flag:</strong> Ping increase &gt;50ms or speed drop &gt;10%</li>
					</ul>
				</div>
			</div>

			<div class="step">
				<h3><span class="step-number">2</span> Identify the Cause</h3>
				<p>Most slowdowns have nothing to do with filtering. Common culprits:</p>

				<h4>Network Congestion (Not Filtering)</h4>
				<ul>
					<li>Too many devices connected simultaneously</li>
					<li>Someone streaming 4K video or gaming</li>
					<li>Background updates/backups running</li>
					<li><strong>Test:</strong> Disconnect other devices. Speed improve? Not filtering's fault.</li>
				</ul>

				<h4>ISP Issues (Not Filtering)</h4>
				<ul>
					<li>ISP-side congestion during peak hours</li>
					<li>Service outages or degradation</li>
					<li>Oversubscribed neighborhood network</li>
					<li><strong>Test:</strong> Disable filtering. Still slow? Call ISP.</li>
				</ul>

				<h4>Router Problems (Not Filtering)</h4>
				<ul>
					<li>Old router can't handle your internet speed</li>
					<li>Router overheating or failing</li>
					<li>Outdated firmware with bugs</li>
					<li><strong>Test:</strong> Connect computer directly to modem with Ethernet. Faster? Router issue.</li>
				</ul>

				<h4>Actual Filtering Issues (Rare)</h4>
				<ul>
					<li>Distant DNS server location</li>
					<li>DNS server overloaded/having issues</li>
					<li>Too many DNS lookups (misconfiguration)</li>
				</ul>
			</div>
		</section>

		<section class="guide-section">
			<h2>Solutions by Cause</h2>

			<div class="step">
				<h3>If It's Actually DNS Filtering:</h3>

				<h4>Switch to Faster DNS Servers</h4>
				<p>Different providers have different server locations:</p>

				<table class="comparison-table">
					<thead>
						<tr>
							<th>Provider</th>
							<th>Avg Latency</th>
							<th>Server Locations</th>
							<th>Status</th>
						</tr>
					</thead>
					<tbody>
						<tr>
							<td>Cloudflare Family</td>
							<td>12ms</td>
							<td>275+ cities worldwide</td>
							<td>Fastest</td>
						</tr>
						<tr>
							<td>CleanBrowsing</td>
							<td>18ms</td>
							<td>Global anycast network</td>
							<td>Fast</td>
						</tr>
						<tr>
							<td>OpenDNS</td>
							<td>22ms</td>
							<td>25+ data centers</td>
							<td>Good</td>
						</tr>
						<tr>
							<td>Quad9 Family</td>
							<td>25ms</td>
							<td>150+ locations</td>
							<td>Good</td>
						</tr>
					</tbody>
				</table>

				<Alert type="info">
					Try switching to <strong>Cloudflare for Families (1.1.1.3 / 1.0.0.3)</strong> for maximum speed
					with filtering.
				</Alert>

				<h4>Use DNS Caching</h4>
				<p>Reduce repeated lookups by enabling DNS caching on your router:</p>
				<ol>
					<li>Log into router admin panel</li>
					<li>Look for "DNS Proxy" or "DNS Caching" option</li>
					<li>Enable it if available</li>
					<li>Set cache time to 3600 seconds (1 hour)</li>
				</ol>

				<h4>Optimize DNS Configuration</h4>
				<ol>
					<li>Use only 2 DNS servers (primary + secondary), not 3-4</li>
					<li>Choose servers from same provider (don't mix OpenDNS + CleanBrowsing)</li>
					<li>Test individual servers and use the fastest one as primary</li>
				</ol>

				<h4>Test Server Latency</h4>
				<p>Find which DNS server is fastest from your location:</p>
				<pre><code>ping 208.67.222.123
ping 185.228.168.168
ping 1.1.1.3</code></pre>
				<p>Use the one with lowest ping time as your primary DNS.</p>
			</div>

			<div class="step">
				<h3>If It's Router-Related:</h3>

				<h4>Update Router Firmware</h4>
				<ol>
					<li>Log into router admin</li>
					<li>Navigate to System or Administration</li>
					<li>Check for firmware updates</li>
					<li>Update if available (improves performance + security)</li>
				</ol>

				<h4>Restart Router Properly</h4>
				<ol>
					<li>Unplug router AND modem from power</li>
					<li>Wait 30 seconds</li>
					<li>Plug in modem, wait for all lights to stabilize (2 min)</li>
					<li>Plug in router, wait for all lights to stabilize (2 min)</li>
					<li>Test speeds again</li>
				</ol>

				<h4>Check Router Resources</h4>
				<p>Some routers show resource usage:</p>
				<ul>
					<li>CPU usage &gt;80%? Too many devices or old router</li>
					<li>Memory &gt;90%? Reboot router or upgrade</li>
					<li>Check temperature - overheating causes slowdowns</li>
				</ul>

				<h4>Upgrade Router (If Necessary)</h4>
				<p>Signs you need a new router:</p>
				<ul>
					<li>Router is 5+ years old</li>
					<li>Your internet speed exceeds router's rated speed</li>
					<li>You have 15+ connected devices</li>
					<li>Router doesn't support AC or AX WiFi standards</li>
				</ul>
				<p>
					Recommended: <strong>$80-150 router</strong> with AC1900+ or AX1800+ for most homes.
					See our <a href="/guides/router-config">router recommendations</a>.
				</p>
			</div>

			<div class="step">
				<h3>If It's Software Filtering (Not DNS):</h3>

				<h4>Filtering Software Can Impact Performance</h4>
				<p>Software like Qustodio, Net Nanny, Bark runs on each device:</p>
				<ul>
					<li>Uses 1-5% CPU constantly</li>
					<li>Can slow older devices significantly</li>
					<li>May conflict with other security software</li>
				</ul>

				<h4>Optimization Steps:</h4>
				<ol>
					<li><strong>Update software:</strong> Newer versions are more efficient</li>
					<li><strong>Reduce monitoring frequency:</strong> Check settings for "scan interval"</li>
					<li><strong>Exclude trusted sites:</strong> Add known-safe sites to whitelist</li>
					<li><strong>Uninstall conflicting software:</strong> Don't run multiple antivirus/filtering apps</li>
				</ol>

				<h4>Consider Hybrid Approach:</h4>
				<p>Reduce software filtering load:</p>
				<ul>
					<li>Use DNS filtering for network-wide blocking</li>
					<li>Reserve software filtering only for critical devices</li>
					<li>Use built-in device controls (Screen Time, Family Link) instead of 3rd-party apps</li>
				</ul>
			</div>
		</section>

		<section class="guide-section">
			<h2>Advanced Optimizations</h2>

			<Accordion title="Enable DNS over TLS (DoT) for Speed">
				<p>
					Paradoxically, encrypted DNS can be faster because it prevents ISP interference:
				</p>
				<ol>
					<li>Check if your router supports DoT (advanced routers only)</li>
					<li>Configure with your filtering provider's DoT address</li>
					<li>Example - CleanBrowsing DoT: <code>family-filter-dns.cleanbrowsing.org</code></li>
					<li>Can reduce latency by 5-15ms if ISP was interfering</li>
				</ol>
				<Alert type="warning">
					Not all routers support this. Don't use DoH (DNS over HTTPS) as it bypasses filtering.
				</Alert>
			</Accordion>

			<Accordion title="Use Local DNS Resolver (Pi-hole)">
				<p>
					Advanced users can run a local DNS server that caches aggressively:
				</p>
				<ul>
					<li><strong>Pi-hole:</strong> Runs on Raspberry Pi ($35), caches all DNS locally</li>
					<li>First lookup: normal speed</li>
					<li>Subsequent lookups: &lt;1ms (instant)</li>
					<li>Bonus: Blocks ads network-wide</li>
				</ul>
				<p>
					Pi-hole can forward to filtering DNS providers for content blocking.
					See <a href="/guides/firewall">advanced filtering guide</a>.
				</p>
			</Accordion>

			<Accordion title="Configure Quality of Service (QoS)">
				<p>
					Prioritize important traffic over background tasks:
				</p>
				<ol>
					<li>Router admin ‚Üí QoS or Traffic Management</li>
					<li>Enable QoS</li>
					<li>Prioritize: VoIP calls, video calls, gaming</li>
					<li>Deprioritize: Downloads, updates, file transfers</li>
				</ol>
				<p>This won't fix slow speeds, but makes important tasks feel faster.</p>
			</Accordion>

			<Accordion title="Separate WiFi Networks by Speed">
				<p>
					Older devices on WiFi 4 (802.11n) slow down the entire network:
				</p>
				<ol>
					<li>Create two WiFi networks: one 5GHz only, one 2.4GHz</li>
					<li>Put fast devices on 5GHz network</li>
					<li>Put IoT/old devices on 2.4GHz network</li>
					<li>Apply filtering DNS to both</li>
				</ol>
			</Accordion>

			<Accordion title="Monitor Bandwidth Hogs">
				<p>
					Identify which devices/apps consume most bandwidth:
				</p>
				<ul>
					<li>Router admin may show per-device usage</li>
					<li>Use GlassWire (Windows) or Little Snitch (Mac) on computers</li>
					<li>Common culprits: Steam downloads, iCloud backup, Windows updates</li>
					<li>Schedule heavy downloads for off-peak hours</li>
				</ul>
			</Accordion>
		</section>

		<section class="guide-section">
			<h2>When It's Not Fixable</h2>
			<p>Sometimes slowdowns have no solution except upgrading:</p>

			<h4>Your Internet Plan Is Too Slow</h4>
			<ul>
				<li>Modern households need 100+ Mbps for 4+ people</li>
				<li>Streaming 4K needs 25 Mbps per stream</li>
				<li>Video calls need 5-10 Mbps upload</li>
				<li><strong>Solution:</strong> Upgrade internet plan with ISP</li>
			</ul>

			<h4>You Have Too Many Devices</h4>
			<ul>
				<li>Budget routers handle 10-15 devices maximum</li>
				<li>Each smart home device adds load</li>
				<li><strong>Solution:</strong> Upgrade to business-grade router or mesh system</li>
			</ul>

			<h4>Your House Is Too Large</h4>
			<ul>
				<li>Single router struggles beyond 2,000 sq ft</li>
				<li>Weak WiFi signal = slow speeds</li>
				<li><strong>Solution:</strong> Mesh WiFi system (Eero, Google WiFi, Orbi)</li>
			</ul>
		</section>

		<section class="guide-section">
			<h2>Prevention Checklist</h2>
			<ul class="checklist">
				<li>Use fastest filtering DNS provider for your location (test with ping)</li>
				<li>Keep router firmware updated</li>
				<li>Reboot router monthly (set calendar reminder)</li>
				<li>Don't run multiple security/filtering apps on same device</li>
				<li>Use Ethernet for desktop computers and gaming consoles</li>
				<li>Position router centrally, elevated, away from interference</li>
				<li>Upgrade router every 3-4 years</li>
			</ul>
		</section>

		<div class="related-guides">
			<h2>Related Guides</h2>
			<div class="related-grid">
				<a href="/troubleshooting/dns-not-working" class="related-card">
					<h3>DNS Not Working</h3>
					<p>Fix DNS filtering that isn't taking effect</p>
				</a>
				<a href="/guides/router-config" class="related-card">
					<h3>Router Configuration</h3>
					<p>Optimize router settings for performance</p>
				</a>
				<a href="/guides/dns-filtering" class="related-card">
					<h3>DNS Filtering Setup</h3>
					<p>Configure DNS filtering correctly from the start</p>
				</a>
			</div>
		</div>
	</div>
</Layout>

<style>
	.guide-container {
		max-width: 900px;
		margin: 0 auto;
		padding: var(--space-8) var(--space-4);
	}

	.guide-header {
		position: relative;
		padding-bottom: var(--space-6);
		border-bottom: 3px solid var(--color-primary-500);
		margin-bottom: var(--space-8);
	}

	.difficulty-badge {
		display: inline-block;
		padding: var(--space-2) var(--space-4);
		border-radius: var(--radius-full);
		font-size: var(--text-sm);
		font-weight: 600;
		margin-bottom: var(--space-4);
	}

	.difficulty-badge.intermediate {
		background-color: #fef3c7;
		color: #92400e;
	}

	.guide-header h1 {
		font-size: var(--text-4xl);
		font-weight: 800;
		color: var(--color-gray-900);
		margin-bottom: var(--space-3);
		line-height: var(--leading-tight);
	}

	.subtitle {
		font-size: var(--text-xl);
		color: var(--color-gray-600);
		line-height: var(--leading-relaxed);
		margin-bottom: var(--space-4);
	}

	.meta {
		display: flex;
		gap: var(--space-6);
		flex-wrap: wrap;
		font-size: var(--text-base);
		color: var(--color-gray-600);
	}

	.guide-section {
		margin-top: var(--space-10);
	}

	.guide-section h2 {
		font-size: var(--text-3xl);
		font-weight: 700;
		color: var(--color-gray-900);
		margin-bottom: var(--space-6);
	}

	.guide-section h3 {
		font-size: var(--text-2xl);
		font-weight: 600;
		color: var(--color-gray-900);
		margin-top: var(--space-6);
		margin-bottom: var(--space-4);
	}

	.guide-section h4 {
		font-size: var(--text-lg);
		font-weight: 600;
		color: var(--color-gray-800);
		margin-top: var(--space-6);
		margin-bottom: var(--space-3);
	}

	.guide-section p,
	.guide-section li {
		line-height: var(--leading-relaxed);
		color: var(--color-gray-700);
		margin-bottom: var(--space-3);
	}

	.guide-section ul,
	.guide-section ol {
		margin-left: var(--space-6);
		margin-bottom: var(--space-4);
	}

	.guide-section li {
		margin-bottom: var(--space-2);
	}

	.guide-section a {
		color: var(--color-primary-600);
		text-decoration: underline;
	}

	.guide-section a:hover {
		color: var(--color-primary-700);
	}

	.step {
		background-color: var(--color-white);
		border: 2px solid var(--color-gray-200);
		border-radius: var(--radius-lg);
		padding: var(--space-6);
		margin-bottom: var(--space-6);
	}

	.step h3 {
		display: flex;
		align-items: center;
		gap: var(--space-3);
		margin-top: 0;
	}

	.step-number {
		display: inline-flex;
		align-items: center;
		justify-content: center;
		width: 40px;
		height: 40px;
		background-color: var(--color-primary-600);
		color: var(--color-white);
		border-radius: 50%;
		font-weight: 700;
		font-size: var(--text-xl);
	}

	.info-box {
		background-color: var(--color-primary-50);
		border-left: 4px solid var(--color-primary-500);
		padding: var(--space-4);
		margin: var(--space-4) 0;
		border-radius: var(--radius-base);
	}

	.info-box strong {
		display: block;
		color: var(--color-primary-900);
		margin-bottom: var(--space-2);
	}

	.info-box ul {
		margin-left: var(--space-4);
		margin-bottom: 0;
	}

	.comparison-table {
		width: 100%;
		border-collapse: collapse;
		margin: var(--space-4) 0;
		font-size: var(--text-sm);
	}

	.comparison-table thead {
		background-color: var(--color-primary-100);
	}

	.comparison-table th,
	.comparison-table td {
		padding: var(--space-3);
		text-align: left;
		border: 1px solid var(--color-gray-200);
	}

	.comparison-table th {
		font-weight: 600;
		color: var(--color-primary-900);
	}

	.comparison-table tbody tr:hover {
		background-color: var(--color-gray-50);
	}

	pre {
		background-color: var(--color-gray-900);
		color: var(--color-secondary-300);
		padding: var(--space-4);
		border-radius: var(--radius-base);
		overflow-x: auto;
		margin: var(--space-4) 0;
	}

	code {
		font-family: 'Courier New', monospace;
		font-size: var(--text-sm);
	}

	.checklist {
		list-style: none;
		margin-left: 0;
	}

	.checklist li {
		padding-left: var(--space-6);
		position: relative;
	}

	.checklist li:before {
		content: '‚úì';
		position: absolute;
		left: 0;
		color: var(--color-secondary-600);
		font-weight: 700;
	}

	.related-guides {
		margin-top: var(--space-12);
		padding-top: var(--space-8);
		border-top: 2px solid var(--color-gray-200);
	}

	.related-guides h2 {
		font-size: var(--text-2xl);
		font-weight: 700;
		color: var(--color-gray-900);
		margin-bottom: var(--space-6);
	}

	.related-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
		gap: var(--space-4);
	}

	.related-card {
		display: block;
		padding: var(--space-5);
		background-color: var(--color-gray-50);
		border: 1px solid var(--color-gray-200);
		border-radius: var(--radius-lg);
		text-decoration: none;
		transition: all var(--transition-base);
	}

	.related-card:hover {
		border-color: var(--color-primary-500);
		background-color: var(--color-white);
		transform: translateY(-2px);
		box-shadow: var(--shadow-lg);
	}

	.related-card h3 {
		font-size: var(--text-lg);
		font-weight: 600;
		color: var(--color-gray-900);
		margin: 0 0 var(--space-2) 0;
	}

	.related-card p {
		font-size: var(--text-sm);
		color: var(--color-gray-600);
		margin: 0;
	}

	@media (max-width: 768px) {
		.guide-header h1 {
			font-size: var(--text-3xl);
		}

		.comparison-table {
			font-size: var(--text-xs);
		}

		.comparison-table th,
		.comparison-table td {
			padding: var(--space-2);
		}

		.related-grid {
			grid-template-columns: 1fr;
		}
	}
</style>
