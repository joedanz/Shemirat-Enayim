---
interface Props {
	title?: string;
	description?: string;
	url?: string;
	class?: string;
}

const {
	title = 'Shemirat Enayim',
	description = 'Internet safety and filtering resources',
	url,
	class: className = ''
} = Astro.props;

// Get current page URL if not provided
const pageUrl = url || Astro.url.href;
const encodedUrl = encodeURIComponent(pageUrl);
const encodedTitle = encodeURIComponent(title);
const encodedDescription = encodeURIComponent(description);
---

<div class:list={['share-buttons', className]}>
	<h3 class="share-title">Share This Guide</h3>
	<div class="share-buttons-grid">
		<!-- Copy Link -->
		<button
			class="share-btn share-copy"
			data-share-copy
			data-url={pageUrl}
			title="Copy link to clipboard"
		>
			<svg class="share-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
				<path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
			</svg>
			<span class="share-label">Copy Link</span>
		</button>

		<!-- Email -->
		<a
			href={`mailto:?subject=${encodedTitle}&body=${encodedDescription}%0A%0A${encodedUrl}`}
			class="share-btn share-email"
			target="_blank"
			rel="noopener noreferrer"
			title="Share via email"
		>
			<svg class="share-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
				<polyline points="22,6 12,13 2,6"></polyline>
			</svg>
			<span class="share-label">Email</span>
		</a>

		<!-- WhatsApp -->
		<a
			href={`https://wa.me/?text=${encodedTitle}%20${encodedUrl}`}
			class="share-btn share-whatsapp"
			target="_blank"
			rel="noopener noreferrer"
			title="Share on WhatsApp"
		>
			<svg class="share-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>
			</svg>
			<span class="share-label">WhatsApp</span>
		</a>

		<!-- Facebook -->
		<a
			href={`https://www.facebook.com/sharer/sharer.php?u=${encodedUrl}`}
			class="share-btn share-facebook"
			target="_blank"
			rel="noopener noreferrer"
			title="Share on Facebook"
		>
			<svg class="share-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
				<path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
			</svg>
			<span class="share-label">Facebook</span>
		</a>

		<!-- Twitter/X -->
		<a
			href={`https://twitter.com/intent/tweet?text=${encodedTitle}&url=${encodedUrl}`}
			class="share-btn share-twitter"
			target="_blank"
			rel="noopener noreferrer"
			title="Share on Twitter/X"
		>
			<svg class="share-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
				<path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
			</svg>
			<span class="share-label">Twitter</span>
		</a>

		<!-- Print -->
		<button
			class="share-btn share-print"
			onclick="window.print()"
			title="Print this page"
		>
			<svg class="share-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
				<polyline points="6 9 6 2 18 2 18 9"></polyline>
				<path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
				<rect x="6" y="14" width="12" height="8"></rect>
			</svg>
			<span class="share-label">Print</span>
		</button>
	</div>

	<!-- Success message for copy -->
	<div class="share-message" data-share-message style="display: none;">
		âœ“ Link copied to clipboard!
	</div>
</div>

<style>
	.share-buttons {
		background: var(--color-gray-50);
		border: 2px solid var(--color-gray-200);
		border-radius: var(--radius-xl);
		padding: var(--space-6);
		margin: var(--space-8) 0;
	}

	.share-title {
		font-size: var(--text-lg);
		font-weight: 600;
		color: var(--color-gray-900);
		margin: 0 0 var(--space-4) 0;
		text-align: center;
	}

	.share-buttons-grid {
		display: grid;
		grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
		gap: var(--space-3);
	}

	.share-btn {
		display: flex;
		flex-direction: column;
		align-items: center;
		gap: var(--space-2);
		padding: var(--space-4);
		background: white;
		border: 2px solid var(--color-gray-300);
		border-radius: var(--radius-lg);
		cursor: pointer;
		transition: all var(--transition-base);
		text-decoration: none;
		color: var(--color-gray-700);
	}

	.share-btn:hover {
		transform: translateY(-2px);
		box-shadow: var(--shadow-md);
		text-decoration: none;
	}

	.share-copy:hover {
		border-color: var(--color-primary-500);
		background-color: var(--color-primary-50);
		color: var(--color-primary-700);
	}

	.share-email:hover {
		border-color: var(--color-gray-500);
		background-color: var(--color-gray-100);
	}

	.share-whatsapp:hover {
		border-color: #25D366;
		background-color: #E8F5E9;
		color: #128C7E;
	}

	.share-facebook:hover {
		border-color: #1877F2;
		background-color: #E7F3FF;
		color: #1877F2;
	}

	.share-twitter:hover {
		border-color: #000000;
		background-color: #F0F0F0;
		color: #000000;
	}

	.share-print:hover {
		border-color: var(--color-secondary-500);
		background-color: var(--color-secondary-50);
		color: var(--color-secondary-700);
	}

	.share-icon {
		flex-shrink: 0;
	}

	.share-label {
		font-size: var(--text-sm);
		font-weight: 500;
		text-align: center;
	}

	.share-message {
		margin-top: var(--space-4);
		padding: var(--space-3);
		background-color: var(--color-secondary-100);
		color: var(--color-secondary-900);
		border-radius: var(--radius-lg);
		text-align: center;
		font-weight: 500;
		animation: fadeIn 0.3s ease-out;
	}

	@keyframes fadeIn {
		from {
			opacity: 0;
			transform: translateY(-10px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@media (max-width: 768px) {
		.share-buttons-grid {
			grid-template-columns: repeat(3, 1fr);
		}
	}

	@media (max-width: 480px) {
		.share-buttons-grid {
			grid-template-columns: repeat(2, 1fr);
		}
	}
</style>

<script>
	// Copy link functionality
	function initShareButtons() {
		const copyButtons = document.querySelectorAll('[data-share-copy]');

		copyButtons.forEach((button) => {
			button.addEventListener('click', async () => {
				const url = button.getAttribute('data-url') || window.location.href;
				const message = button.closest('.share-buttons')?.querySelector('[data-share-message]') as HTMLElement;

				try {
					await navigator.clipboard.writeText(url);

					// Show success message
					if (message) {
						message.style.display = 'block';
						setTimeout(() => {
							message.style.display = 'none';
						}, 3000);
					}
				} catch (error) {
					// Fallback for browsers that don't support clipboard API
					const textArea = document.createElement('textarea');
					textArea.value = url;
					textArea.style.position = 'fixed';
					textArea.style.left = '-999999px';
					document.body.appendChild(textArea);
					textArea.select();

					try {
						document.execCommand('copy');
						if (message) {
							message.style.display = 'block';
							setTimeout(() => {
								message.style.display = 'none';
							}, 3000);
						}
					} catch (fallbackError) {
						console.error('Failed to copy link:', fallbackError);
						alert('Failed to copy link. Please copy manually: ' + url);
					} finally {
						document.body.removeChild(textArea);
					}
				}
			});
		});
	}

	// Initialize on page load
	if (document.readyState === 'loading') {
		document.addEventListener('DOMContentLoaded', initShareButtons);
	} else {
		initShareButtons();
	}
</script>
